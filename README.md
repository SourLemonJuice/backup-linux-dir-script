# 文件夹备份脚本

这算是一个学习用的脚本了，各种地方写得都应该很差，咕咕

## 能干什么

一个（一堆）备份目录到tar文件的脚本\
支持tar的增量备份模式（不会记录删除有什么用呢）

## 使用

运行 `src/` 中的 `main.sh`，没有默认操作，需要参数\
用`-h | --help`查看帮助信息

虽然脚本文件很多但主脚本中有检测文件本身路径的逻辑，不用担心不在脚本根目录执行会无法加载其他函数的问题

> 打包和解包前后都有提示信息，不会直接执行的

提示性输出示例:

```text
tar完整备份模式 [按回车确认]
设置新编号为 1700956381_2023-11-26_07-53-01
===================================================================================================================================================================
源: [!PrivateFolder!]
目标文件夹: [!PrivateFolder!]
排除参数: --exclude=./lost+found --exclude=[!PrivateFolder!]
接收到的备份模式: full
tar压缩参数:
===================================================================================================================================================================
[回车继续 其他输入则终止]
tar: .：目录是新的
tar: ./dev：目录是新的
./
./dev/
./.a
./a
./b
./c
1700956384_2023-11-26_07-53-04_backup.tar 打包结束
```

---

## 备份格式

未来可能有其他的方式吧

### tar

> 使用`--one-file-system`参数，不会打包正常根目录里的`dev`这类文件夹

```text
.
├── 1700956381_2023-11-26_07-53-01
│   ├── 1700956384_2023-11-26_07-53-04_backup.tar
│   ├── .log
│   └── .tar_snapshot
├── 1700956534_2023-11-26_07-55-34
│   ├── 1700956535_2023-11-26_07-55-35_backup.tar
│   ├── 1700956584_2023-11-26_07-56-24_backup.tar
│   ├── .log
│   └── .tar_snapshot
└── .now_backup
```

## 配置

将需要修改的文件放入`src/config.d`文件夹就能生效（用的bash赋值的语法）

### 强制使用root权限

可以在执行脚本前检查是否为root权限

```shell
# general
NeedRoot=1
```

### 备份路径

`BackupFolder`是要存放备份文件的根路径\
`RootPath`是要备份的目录

> 所有目录都可以使用相对路径（相对于那堆脚本文件）

```shell
# path
BackupFolder=/usr/sys_backup
RootPath=/
```

### tar增量备份

强制每次备份使用完整备份\
开启=不使用tar增量备份模式（-g 参数）

```shell
# general
Tar_Default_Full_Backup=1
```

### 日志目录

设置日志存放的目录（目前没什么有用的信息啦）
> 不要在最后加 / 我也不知道为什么

```shell
# log
RunningLogPath=./log
```

## 怪问题们

- 为什么不把东西都放到一起呀，这样多乱
  - 那就彻底看不懂了啊w
  - 还有...懒，反正有配置文件在两个文件和一堆文件也没什么区别嘛
- 为什么注释用中文，各种变量名用英文还写得稀烂
  - 因为不会英语所以要练嘛，那既然不会注释还写英文那我还写它干什么
- 就是压缩解压一下怎么写了这么一大坨东西出来
  - 最开始是想写一个类似于定期备份系统的脚本，弄了半天才发现tar没法记录文件的删除，但已经写了按顺序解压的逻辑了就顺便把其他的东西完善一下，反正也是在学东西嘛
